import{a as be}from"./mPgzQuY8.js";import{z as R,c as we,a as Ie,b as Ve,_ as Be}from"./BmxFDBWl.js";import{_ as Ce}from"./DZo4A9xQ.js";import{_ as je}from"./En5Trtf1.js";import{u as Ne}from"./5WMO9-vL.js";import{d as xe,P as $e,r as B,f as q,K as Pe,a as g,G as Ue,C as m,e as u,A as f,b as l,t as d,i as e,j as z,m as qe,w as Ae,Q as Me,o as Ee,c as k,F as ye,k as V}from"./DSMXS7QP.js";import"./C1MORkun.js";import"./q2IQmtD9.js";const Re={class:"p-4"},ze={class:"flex flex-row justify-between"},Fe=xe({__name:"package-booking-modal",props:{modelValue:{type:Boolean},packageData:{},eventData:{},numAdults:{},numChildren:{},availableDatesIndex:{},totalPrice:{}},emits:["update:modelValue"],setup(s,{emit:A}){const{addPackageBooking:M}=Ne(),D=$e(),h=B(null),C=A,_=q({get:()=>s.modelValue,set:w=>C("update:modelValue",w)}),t=Pe({name:"",email:""}),i=R.object({name:R.string().min(1,"Name is required"),email:R.string().email("Valid email required")}),p=()=>{_.value=!1,t.name="",t.email=""},r=()=>{M({startDate:s.eventData.hotels[s.packageData.hotelId-1].available_dates[s.availableDatesIndex].date,endDate:s.eventData.hotels[s.packageData.hotelId-1].available_dates[s.availableDatesIndex].arrival_home_day,package:s.packageData.name,event:s.eventData.title,hotel:s.eventData.hotels[s.packageData.hotelId-1].name,activity:s.packageData.activity.name,mealPlan:s.packageData.mealPlan,flightIncluded:s.packageData.flightIncluded,cancellationProtection:!1,totalPrice:s.totalPrice,numAdults:s.numAdults,numChildren:s.numChildren,name:t.name,email:t.email}),_.value=!1,t.name="",t.email="",D.push("/booking")};return(w,c)=>{const j=Ce,I=we,N=be,E=Ie,o=je,a=Ve;return g(),Ue(a,{modelValue:e(_),"onUpdate:modelValue":c[2]||(c[2]=n=>z(_)?_.value=n:null)},{default:m(()=>[u(o,null,{default:m(()=>[c[5]||(c[5]=f(" Confirm Package Booking ")),l("p",null,d(`Booking for: ${w.packageData.name}`),1),u(E,{ref_key:"form",ref:h,state:e(t),schema:e(i),onSubmit:r},{default:m(()=>[l("div",Re,[u(I,{label:"Name of Booker",required:!0,name:"name",class:"mb-4"},{default:m(()=>[u(j,{placeholder:"Your name",modelValue:e(t).name,"onUpdate:modelValue":c[0]||(c[0]=n=>e(t).name=n)},null,8,["modelValue"])]),_:1}),u(I,{label:"Email Address",required:!0,name:"email",class:"mb-4"},{default:m(()=>[u(j,{type:"email",placeholder:"Your email",modelValue:e(t).email,"onUpdate:modelValue":c[1]||(c[1]=n=>e(t).email=n)},null,8,["modelValue"])]),_:1}),u(I,null,{default:m(()=>[l("span",ze,[u(N,{type:"submit"},{default:m(()=>c[3]||(c[3]=[f("Submit")])),_:1}),u(N,{onClick:p},{default:m(()=>c[4]||(c[4]=[f("Cancel")])),_:1})])]),_:1})])]),_:1},8,["state","schema"])]),_:1})]),_:1},8,["modelValue"])}}}),Se=Object.assign(Fe,{__name:"PackageBookingModal"}),Te={key:1,class:"flex flex-col gap-16"},Oe={class:"flex flex-col lg:flex-row-reverse justify-between gap-4"},Ge=["src","alt"],Ye={class:"flex flex-col gap-8 justify-center align-center h-100%"},He={class:"font-bold text-lg"},Ke={class:"flex flex-col"},Le={key:0},Qe={key:1},Je={key:2},We={class:"flex flex-col"},Xe={key:0},Ze={key:1},ea={key:2},aa={class:"pt-4"},ta={class:"flex flex-col lg:flex-row justify-evenly gap-8"},la={class:"flex flex-col gap-2"},na={class:"flex gap-2"},oa={class:"flex gap-2"},sa={class:"flex flex-col justify-center"},ia={class:"flex flex-col justify-center"},ga=xe({__name:"[id]",setup(s){const A={none:0,breakfast:150,half_board:450,all_inclusive:850},M=o=>{switch(o){case"breakfast":return"Breakfast";case"half_board":return"Half Board";case"all_inclusive":return"All Inclusive";default:return"Error"}},D=B(!1),h=qe(),C=h.params.id,_=B(!0),t=B(),i=B(),p=B(Number(h.query.di)||0),r=Pe({adults:(Number(h.query.na)>=1?Number(h.query.na):1)||1,children:(Number(h.query.nc)>=0?Number(h.query.nc):0)||0}),w=$e();Ae([p,r],([o,a],n)=>{w.push({path:`/packs/${C}`,query:{di:o,na:a.adults,nc:a.children}})});const c=q(()=>{var o,a,n,v,$,y,b,x,U;return p.value>((n=(a=i.value)==null?void 0:a.hotels[((o=t.value)==null?void 0:o.hotelId)-1])==null?void 0:n.available_dates.length)-1&&(p.value=0),~~((new Date((y=($=i.value)==null?void 0:$.hotels[((v=t.value)==null?void 0:v.hotelId)-1])==null?void 0:y.available_dates[p.value||0].arrival_home_day).getTime()-new Date((U=(x=i.value)==null?void 0:x.hotels[((b=t.value)==null?void 0:b.hotelId)-1])==null?void 0:U.available_dates[p.value||0].date).getTime())/(1e3*60*60*24))}),j=q(()=>{var o;return c.value-((o=i.value)==null?void 0:o.estimated_flight_time_days)}),I=q(()=>r.adults+r.children),N=q(()=>{var o,a,n,v,$,y,b,x;return~~(((A[(o=t.value)==null?void 0:o.mealPlan]+((v=(n=i.value)==null?void 0:n.hotels[((a=t.value)==null?void 0:a.hotelId)-1])==null?void 0:v.price_per_day))*I.value*j.value+I.value*(($=i.value)==null?void 0:$.flight_price))*((y=t.value)==null?void 0:y.packageBaseDiscountMultiplier)+((x=(b=t.value)==null?void 0:b.activity)==null?void 0:x.price))}),E=async()=>{try{const o=await fetch(`http://localhost:3001/packages?id=${C}`);if(!o.ok)throw new Error("404, No package data found.");const a=await o.json();if(a.length<1)throw new Error("404, No package data found.");t.value=a[0];const n=await fetch(`http://localhost:3001/events?id=${t.value.eventId}`);if(!n.ok)throw new Error("500, Package data is incomplete.");const v=await n.json();if(v.length<1)throw new Error("500, Package data is incomplete.");i.value=v[0]}catch(o){console.error(o)}finally{_.value=!1}};return Me(()=>{Object.keys(h.query).length!=3&&w.push({path:`/packs/${C}`,query:{di:0,na:1,nc:0}})}),Ee(()=>{E()}),(o,a)=>{var y,b,x,U,F,S,T,O,G,Y,H,K,L,Q,J,W,X,Z,ee,ae,te,le,ne,oe,se,ie,de,ue,re,ce,me,pe,fe,ve,ge,he,ke,_e;const n=be,v=Be,$=Se;return g(),k(ye,null,[e(_)?(g(),k(ye,{key:0},[f("Loading...")],64)):(g(),k("div",Te,[l("div",Oe,[l("div",null,[l("img",{class:"rounded-lg",src:(x=(b=e(i))==null?void 0:b.hotels[((y=e(t))==null?void 0:y.hotelId)-1])==null?void 0:x.image,alt:(S=(F=e(i))==null?void 0:F.hotels[((U=e(t))==null?void 0:U.hotelId)-1])==null?void 0:S.name},null,8,Ge)]),l("div",Ye,[l("h2",He,d(`${(T=e(t))==null?void 0:T.name} | Package`),1),l("div",Ke,[a[7]||(a[7]=l("h3",{class:"font-bold pb-1"},"Package contents",-1)),l("p",null,d(`* ${(O=e(i))==null?void 0:O.title}`),1),l("p",null,d(`* ${(H=(Y=e(i))==null?void 0:Y.hotels[((G=e(t))==null?void 0:G.hotelId)-1])==null?void 0:H.name}`),1),(K=e(t))!=null&&K.flightIncluded?(g(),k("p",Le,"* Flight included")):V("",!0),((L=e(t))==null?void 0:L.mealPlan)!="none"?(g(),k("p",Qe,d(`* ${M((Q=e(t))==null?void 0:Q.mealPlan)}`),1)):V("",!0),((W=(J=e(t))==null?void 0:J.activity)==null?void 0:W.name.length)>0?(g(),k("p",Je,d(`* ${(Z=(X=e(t))==null?void 0:X.activity)==null?void 0:Z.name}`),1)):V("",!0)]),l("div",We,[a[8]||(a[8]=l("h3",{class:"font-bold pb-1"},"Price breakdown",-1)),a[9]||(a[9]=l("h4",{class:"font-bold pb-0.25"},"Package base",-1)),l("p",null,d(`* ${(te=(ae=e(i))==null?void 0:ae.hotels[((ee=e(t))==null?void 0:ee.hotelId)-1])==null?void 0:te.name}: $${(oe=(ne=e(i))==null?void 0:ne.hotels[((le=e(t))==null?void 0:le.hotelId)-1])==null?void 0:oe.price_per_day}/day/person`),1),((se=e(t))==null?void 0:se.mealPlan)!="none"?(g(),k("p",Xe,d(`* ${M((ie=e(t))==null?void 0:ie.mealPlan)}: $${A[(de=e(t))==null?void 0:de.mealPlan]}/day/person`),1)):V("",!0),(ue=e(t))!=null&&ue.flightIncluded?(g(),k("p",Ze,d(`* Flight: $${e(i).flight_price}/person`),1)):V("",!0),a[10]||(a[10]=l("h4",{class:"font-bold pb-0.25"},"Package exclusives",-1)),l("p",null,d(`* ${~~((1-((re=e(t))==null?void 0:re.packageBaseDiscountMultiplier))*100)}% off "Package base"`),1),((me=(ce=e(t))==null?void 0:ce.activity)==null?void 0:me.name.length)>0?(g(),k("p",ea,d(`* ${(fe=(pe=e(t))==null?void 0:pe.activity)==null?void 0:fe.name}: $${(ge=(ve=e(t))==null?void 0:ve.activity)==null?void 0:ge.price}`),1)):V("",!0),l("span",aa,[l("p",null,d(`Trip duration: ${e(c)} days`),1),l("p",null,d(`Days at hotel: ${e(j)} days`),1),l("p",null,d(`Total: $${e(N)}`),1)])])])]),l("div",ta,[l("span",la,[a[15]||(a[15]=l("h3",null,"People",-1)),l("span",na,[f(d(`Adults: ${e(r).adults}`)+" ",1),u(n,{size:"xs",variant:"solid",onClick:a[0]||(a[0]=()=>e(r).adults++)},{default:m(()=>a[11]||(a[11]=[f(" + ")])),_:1}),u(n,{size:"xs",variant:"solid",onClick:a[1]||(a[1]=()=>{e(r).adults>1&&e(r).adults--})},{default:m(()=>a[12]||(a[12]=[f(" - ")])),_:1})]),l("span",oa,[f(d(`Children: ${e(r).children}`)+" ",1),u(n,{size:"xs",variant:"solid",onClick:a[2]||(a[2]=()=>e(r).children++)},{default:m(()=>a[13]||(a[13]=[f(" + ")])),_:1}),u(n,{size:"xs",variant:"solid",onClick:a[3]||(a[3]=()=>{e(r).children>0&&e(r).children--})},{default:m(()=>a[14]||(a[14]=[f(" - ")])),_:1})])]),l("span",sa,[a[16]||(a[16]=l("h3",null,"Avalible dates",-1)),u(v,{modelValue:e(p),"onUpdate:modelValue":a[4]||(a[4]=P=>z(p)?p.value=P:null),options:((_e=(ke=e(i))==null?void 0:ke.hotels[((he=e(t))==null?void 0:he.hotelId)-1])==null?void 0:_e.available_dates).map((P,De)=>({label:`${P.date} to ${P.arrival_home_day}`,value:De}))},null,8,["modelValue","options"])]),l("span",ia,[u(n,{size:"lg",variant:"solid",class:"text-md justify-center",onClick:a[5]||(a[5]=P=>D.value=!0)},{default:m(()=>a[17]||(a[17]=[f(" Book ")])),_:1})])])])),u($,{modelValue:e(D),"onUpdate:modelValue":a[6]||(a[6]=P=>z(D)?D.value=P:null),"package-data":e(t),"event-data":e(i),"num-adults":e(r).adults,"num-children":e(r).children,"available-dates-index":e(p),"total-price":e(N)},null,8,["modelValue","package-data","event-data","num-adults","num-children","available-dates-index","total-price"])],64)}}});export{ga as default};
